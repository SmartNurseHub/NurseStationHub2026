<!-- =========================================================
     VIEW : Nursing Records (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•)
     ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÑ‡∏ü‡∏•‡πå:
       ‚Ä¢ ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô navTo('nursingRecords') ‡πÉ‡∏ô app.js
       ‚Ä¢ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ backend API:
            - POST /api/NursingRecords/save
            - GET /api/nursingRecords
========================================================= -->
<!-- =========================================================
     SECTION 1: ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö Tab (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå / ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå)
     ‡πÉ‡∏ä‡πâ data-tab-target ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô panel
========================================================= -->
<div class="d-flex justify-content-center">
  <div class="btn-group">
    <form class="d-flex align-items-center gap-2">
      <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå -->
      <div class="dropdown">
        <button class="btn dropdown-toggle" 
                style="background-color: #006666;color: #ffffff;font-size: 12px;font-weight: 500;padding: 10px 18px;border-radius: 8px;border: none;"
                type="button"
                id="dropdownMenunursingrecord"
                data-bs-toggle="dropdown"
                aria-expanded="false">
          üë©‚Äç‚öïÔ∏è‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πåüíª
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenunursingrecord"style="min-width: 250px;font-size: 12px;padding: 8px 0;">
          <li><a class="dropdown-item open-tab" data-target-tab="online">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</a></li>
        </ul>
      </div>

      <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ -->
      <div class="dropdown">
        <button class="btn dropdown-toggle"
                style="background-color:#006666;color:#fff;font-size:12px;font-weight:500;
                      padding:10px 18px;border-radius:8px;border:none;"
                type="button"
                id="dropdownMenunursingconsel"
                data-bs-toggle="dropdown"
                aria-expanded="false">
          üë©‚Äç‚öïÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ üí¨
        </button>

        <ul class="dropdown-menu"><li>
          <a class="dropdown-item open-tab" data-target-tab="nursingCounselor">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</a>
        </li>
        <li>
          <a class="dropdown-item" onclick="openNursingCounselor('edit')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
         </li>

      </div>


    </form>
    
  </div>
</div>

<!-- TABLE CONTAINER (TOP - default) -->
<div id="tableTopContainer"></div>

<!-- =========================================================
     SECTION 2: TAB ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
     ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ API /api/NursingRecords/save (routes/sheets.js)
========================================================= -->
  <div class="nr-tab-panel" data-tab="online" style="display:none;">

    <!-- ===========================
        ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå API:
          ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend
    ============================ -->
      <div class="col-6 mx-auto mb-3 mt-4">
            <div class="input-group" >
              <span style="font-size:10px;" class="input-group-text">üîç</span>
              <input type="text" id="patientSearch" class="form-control" autocomplete="off"/>
              <button style="font-size:10px;" type="button" class="btn btn-primary" id="btnSearchPatient">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <div id="searchResults" class="list-group position-absolute w-100" style="z-index:1000; display:none;"></div>
      </div>

      <div>
        <form id="nursingForm" class="row g-3">
            <!-- Basic Info -->
            <div class="col-md-2" >
              <label style="font-size:10px;" class="form-label mb-0">NSR No.</label>
              <input style="font-size:10px;" type="text" class="form-control" id="NSR" name="NSR" readonly>
            </div>
            <div class="col-md-2" hidden>
              <label class="form-label mb-0">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
              <input type="text" class="form-control" id="Stamp" name="Stamp">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;" style="font-size:10px;" class="form-label mb-0">HN</label>
              <input style="font-size:10px;" type="text" class="form-control" id="HN" name="HN">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;"class="form-label mb-0">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
              <input style="font-size:10px;"type="text" class="form-control" id="CID" name="CID">
            </div>
            <div class="col-md-2" hidden>
              <label style="font-size:10px;"class="form-label mb-0">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
              <input style="font-size:10px;"type="text" class="form-control" id="PRENAME" name="PRENAME">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;"class="form-label mb-0">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
              <input style="font-size:10px;"type="text" class="form-control" id="NAME" name="NAME">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;"class="form-label mb-0">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
              <input style="font-size:10px;"type="text" class="form-control" id="LNAME" name="LNAME">
            </div>
            <div class="col-md-2" hidden>
              <label style="font-size:10px;"class="form-label mb-0">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
              <input style="font-size:10px;"type="text" class="form-control" id="BIRTH" name="BIRTH">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;"class="form-label mb-0">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
              <input style="font-size:10px;"type="text" class="form-control" id="TELEPHONE" name="TELEPHONE">
            </div>
            <div class="col-md-2">
              <label style="font-size:10px;"class="form-label mb-0">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
              <input style="font-size:10px;"type="date" class="form-control" id="DateService" name="DateService">
            </div>
            <div class="col-md-5">
              <label style="font-size:10px;"class="form-label mb-0">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</label>
              <input style="font-size:10px;"type="text" class="form-control" id="Activity" name="Activity">
            </div>
            <div class="col-md-5">
              <label style="font-size:10px;"class="form-label mb-0">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
              <input style="font-size:10px;"type="text" class="form-control" id="Objective" name="Objective">
            </div>
            <div class="col-6">
              <label style="font-size:10px;" class="form-label mb-0">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</label>
              <textarea style="font-size:10px;"class="form-control"id="HealthInform"name="HealthInform"rows="2"data-type="inform"></textarea>
            </div>
            <div class="col-6">
              <label style="font-size:10px;" class="form-label mb-0">‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</label>
              <textarea style="font-size:10px;"class="form-control"id="HealthAdvice"name="HealthAdvice"rows="2"data-type="advice"></textarea>
            </div>

            <!-- Follow-ups Tabs -->
            <ul class="nav nav-tabs mb-2" id="followUpTabs" role="tablist">
              <li class="nav-item">
                <button style="font-size:10px;"class="nav-link active" id="follow1-tab" data-bs-toggle="tab" data-bs-target="#follow1" type="button" role="tab">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1</button>
              </li>
              <li class="nav-item">
                <button style="font-size:10px;"class="nav-link" id="follow2-tab" data-bs-toggle="tab" data-bs-target="#follow2" type="button" role="tab">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2</button>
              </li>
              <li class="nav-item">
                <button style="font-size:10px;"class="nav-link" id="follow3-tab" data-bs-toggle="tab" data-bs-target="#follow3" type="button" role="tab">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 3</button>
              </li>
            </ul>

            <div class="tab-content" id="followUpTabsContent">
              <!-- Follow-up 1 -->
              <div class="tab-pane fade show active" id="follow1" role="tabpanel">
                <div class="row g-2">
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:</label>
                    <input style="font-size:10px;"type="date" class="form-control form-control-sm" id="DateFollow1" name="DateFollow1">
                  </div>
                  <div class="col-2">
                    <label style="font-size:10px;">‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <input style="font-size:10px;"type="time" class="form-control form-control-sm" id="TimeFollow1" name="TimeFollow1">
                  </div>
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á:</label>
                    <select style="font-size:10px;" class="form-select form-select-sm" id="RouteFollow1" name="RouteFollow1">
                      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --</option>
                      <option value="Line OA">Line OA</option>
                      <option value="Facebook">Facebook</option>
                      <option value="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                      <option value="‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option>
                      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                  </div>
                  <div class="col-4">
                    <label style="font-size:10px;">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</label>
                    <textarea style="font-size:10px;" class="form-control form-control-sm"id="Provider1" name="Provider1" rows="1" data-type="provider"></textarea>
                  </div>
                  <div class="col-12">
                    <label style="font-size:10px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</label>
                    <textarea style="font-size:10px;" class="form-control form-control-sm"id="Response1" name="Response1" rows="1" data-type="response"></textarea>
                  </div>
                </div>
              </div>

              <!-- Follow-up 2 -->
              <div class="tab-pane fade" id="follow2" role="tabpanel">
                <div class="row g-2">
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:</label>
                    <input style="font-size:10px;"type="date" class="form-control form-control-sm" id="DateFollow2" name="DateFollow2">
                  </div>
                  <div class="col-2">
                    <label style="font-size:10px;">‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <input style="font-size:10px;" type="time" class="form-control form-control-sm" id="TimeFollow2" name="TimeFollow2">
                  </div>
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á:</label>
                    <select style="font-size:10px;" class="form-select form-select-sm" id="RouteFollow2" name="RouteFollow2">
                      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --</option>
                      <option value="Line OA">Line OA</option>
                      <option value="Facebook">Facebook</option>
                      <option value="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                      <option value="‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option>
                      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                  </div>
                  <div class="col-4">
                    <label style="font-size:10px;">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</label>
                    <textarea style="font-size:10px;" class="form-control form-control-sm"id="Provider2" name="Provider2" rows="1" data-type="provider"></textarea>
                  </div>
                  <div class="col-12">
                    <label style="font-size:10px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</label>
                    <textarea style="font-size:10px;" class="form-control form-control-sm"id="Response2" name="Response2" rows="1" data-type="response"></textarea>
                  </div>
                </div>
              </div>

              <!-- Follow-up 3 -->
              <div class="tab-pane fade" id="follow3" role="tabpanel">
                <div class="row g-2">
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:</label>
                    <input style="font-size:10px;"type="date" class="form-control form-control-sm" id="DateFollow3" name="DateFollow3">
                  </div>
                  <div class="col-2">
                    <label style="font-size:10px;">‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <input style="font-size:10px;"type="time" class="form-control form-control-sm" id="TimeFollow3" name="TimeFollow3">
                  </div>
                  <div class="col-3">
                    <label style="font-size:10px;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á:</label>
                    <select style="font-size:10px;"class="form-select form-select-sm" id="RouteFollow3" name="RouteFollow3">
                      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --</option>
                      <option value="Line OA">Line OA</option>
                      <option value="Facebook">Facebook</option>
                      <option value="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                      <option value="‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option>
                      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                  </div>
                  <div class="col-4">
                    <label style="font-size:10px;">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</label>
                    <input style="font-size:10px;" class="form-control form-control-sm"id="Provider3" name="Provider3" rows="1" data-type="provider"></input>
                  </div>
                  <div class="col-12">
                    <label style="font-size:10px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</label>
                    <textarea style="font-size:10px;" class="form-control form-control-sm"id="Response3" name="Response3" rows="1" data-type="response"></textarea>
                  </div>
                </div>
              </div>

            </div> <!-- tab-content -->

            <div class="col-12 mt-2">
              <button style="font-size:10px;" type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
          <!-- üîΩ ‡∏Å‡∏•‡πà‡∏≠‡∏á suggestion ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏∏‡∏Å textarea -->
        <div id="textarea-suggest"class="list-group position-absolute"style="z-index:2000; display:none; font-size:10px;"></div>
      </div>
 


      <!-- TABLE CONTAINER (BOTTOM - when form opened) -->
      <div id="tableBottomContainer"></div>


  <!-- =======================================================
       TABLE: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å GET /api/nursingRecords
       ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÑ‡∏ü‡∏•‡πå:
         - ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏à‡∏≤‡∏Å loadNursingRecords() ‡πÉ‡∏ô app.js ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
======================================================= -->
<!-- ================= TABLE CONTAINER ================= -->
    <div class="mt-4" id="nursingTableSection">
      <h6 class="text-center mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</h6>

      <div class="table-responsive">
        <table class="table table-bordered table-striped" style="font-size:10px;">
          <thead class="table-primary text-center">
            <tr>
              <th width="12%">NSR No.</th>
              <th width="12%">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
              <th width="8%">HN</th>
              <th width="20%">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•</th>
              <th width="20%">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
              <th width="13%">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
              <th width="15%">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="nursingTableBody"></tbody>
        </table>
      </div>
    </div>
 </div>

<!-- =========================================================
     SECTION 3: TAB ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
     ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ API /api/NursingRecords/save (routes/sheets.js)
========================================================= -->
  <div class="nr-tab-panel" data-tab="nursingCounselor" style="display:none;">
    
        <!-- SECTION 3 SEARCH -->
<div class="col-6 mx-auto mb-3 mt-4 position-relative">
  <div class="input-group">
    <span style="font-size:10px;" class="input-group-text">üîç</span>

    <input type="text"
           id="patientSearchCounsel"
           class="form-control"
           autocomplete="off"/>

    <button style="font-size:10px;"
            type="button"
            class="btn btn-primary"
            id="btnSearchPatientCounsel">
      ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    </button>
  </div>

  <div id="searchResultsCounsel"
       class="list-group w-100"
       style="z-index:1000; display:none; position:absolute;">
  </div>
</div>


    
    
    <form id="generalForm">

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ================= -->
  <h6 class="mt-2 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</h6>
  <div class="row g-2">
    <div class="col-md-6">
      <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•</label>
      <input type="text" class="form-control" name="patient_name">
    </div>
    <div class="col-md-2">
      <label class="form-label">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
      <input type="number" class="form-control" name="age">
    </div>
    <div class="col-md-4">
      <label class="form-label">‡πÄ‡∏û‡∏®</label>
      <select class="form-select" name="gender">
        <option>‡∏ä‡∏≤‡∏¢</option>
        <option>‡∏´‡∏ç‡∏¥‡∏á</option>
        <option>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">HN / CID</label>
      <input type="text" class="form-control" name="patient_id">
    </div>
    <div class="col-md-4">
      <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label>
      <input type="date" class="form-control" name="visit_date">
    </div>
    <div class="col-md-4">
      <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
      <input type="text" class="form-control" name="service_unit">
    </div>

    <div class="col-md-6">
      <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label>
      <input type="text" class="form-control" name="nurse_name">
    </div>
  </div>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ (Chief Concern)</h6>
  <textarea class="form-control" rows="2" name="chief_concern"></textarea>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (Assessment)</h6>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="assessment_domains[]" value="physical"> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏¢
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="assessment_domains[]" value="mental"> ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï/‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="assessment_domains[]" value="behavior"> ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="assessment_domains[]" value="social"> ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß
  </div>
  <textarea class="form-control mt-2" rows="2" name="assessment_detail"
    placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"></textarea>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• / ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h6>
  <textarea class="form-control" rows="2" name="nursing_diagnosis"></textarea>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5 ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</h6>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="objectives[]" value="knowledge"> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="objectives[]" value="behavior"> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="objectives[]" value="motivation"> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="objectives[]" value="prevention"> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡πÅ‡∏ó‡∏£‡∏Å‡∏ã‡πâ‡∏≠‡∏ô
  </div>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6 ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</h6>
  <label class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label>
  <textarea class="form-control" rows="2" name="counseling_topic"></textarea>

  <label class="form-label mt-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£</label>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="methods[]" value="discussion"> ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏ä‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="methods[]" value="demonstration"> ‡∏™‡∏≤‡∏ò‡∏¥‡∏ï/‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="methods[]" value="media"> ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤
  </div>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7 ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</h6>
  <select class="form-select" name="evaluation">
    <option>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ</option>
    <option>‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô</option>
    <option>‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</option>
  </select>
  <textarea class="form-control mt-2" rows="2" name="evaluation_detail"
    placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8 ‡πÅ‡∏ú‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏• / ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠</h6>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="followup[]" value="appointment"> ‡∏ô‡∏±‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="followup[]" value="doctor"> ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="followup[]" value="team"> ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏´‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û
  </div>

  <!-- ================= ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 9 ================= -->
  <h6 class="mt-4 fw-bold">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 9 ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</h6>
  <div class="row g-2">
    <div class="col-md-4">
      <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
      <input type="text" class="form-control" name="nurse_position">
    </div>
    <div class="col-md-4">
      <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</label>
      <input type="text" class="form-control" name="license_no">
    </div>
  </div>

  <button class="btn btn-primary mt-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>
  </div>






<script>
(() => {

  const STORAGE_KEY = "nr_textarea_history";
  let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

  const suggestBox = document.getElementById("textarea-suggest");
  let activeTextarea = null;

  // ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö textarea ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ data-type
  document.querySelectorAll("textarea[data-type]").forEach(textarea => {

    textarea.addEventListener("input", e => {
      activeTextarea = textarea;

      const type = textarea.dataset.type;
      const value = textarea.value;
      const lastWord = value.split(/\s+/).pop();

      if (!lastWord || lastWord.length < 2) {
        hideSuggest();
        return;
      }

      const words = (history[type] || [])
        .filter(w => w.startsWith(lastWord))
        .slice(0, 6);

      if (words.length === 0) {
        hideSuggest();
        return;
      }

      showSuggest(words, textarea, lastWord);
    });

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á
    textarea.addEventListener("blur", () => {
      saveWords(textarea);
      setTimeout(hideSuggest, 150);
    });

  });

  function showSuggest(words, textarea, lastWord) {
    const rect = textarea.getBoundingClientRect();

    suggestBox.innerHTML = "";
    words.forEach(word => {
      const item = document.createElement("button");
      item.type = "button";
      item.className = "list-group-item list-group-item-action py-1";
      item.textContent = word;

      item.onclick = () => {
        textarea.value =
          textarea.value.substring(
            0,
            textarea.value.lastIndexOf(lastWord)
          ) + word + " ";
        hideSuggest();
        textarea.focus();
      };

      suggestBox.appendChild(item);
    });

    suggestBox.style.display = "block";
    suggestBox.style.top = rect.bottom + window.scrollY + "px";
    suggestBox.style.left = rect.left + window.scrollX + "px";
    suggestBox.style.width = rect.width + "px";
  }

  function hideSuggest() {
    suggestBox.style.display = "none";
  }

  function saveWords(textarea) {
    const type = textarea.dataset.type;
    if (!type) return;

    if (!history[type]) history[type] = [];

    textarea.value
      .split(/[\s,]+/)
      .map(w => w.trim())
      .filter(w => w.length > 2)
      .forEach(word => {
        if (!history[type].includes(word)) {
          history[type].push(word);
        }
      });

    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
  }

})();
/* ===============================
   SEARCH : Nursing Counselor
================================ */
(() => {

  const input   = document.getElementById("patientSearchCounsel");
  const btn     = document.getElementById("btnSearchPatientCounsel");
  const results = document.getElementById("searchResultsCounsel");

  if (!input || !btn || !results) return;

  btn.addEventListener("click", search);
  input.addEventListener("keyup", e => {
    if (e.key === "Enter") search();
  });

  async function search() {
    const q = input.value.trim();
    if (q.length < 2) {
      results.style.display = "none";
      return;
    }

    try {
      const res = await fetch(`/api/patients/search?q=${encodeURIComponent(q)}`);
      const data = await res.json();

      renderResults(data || []);
    } catch (err) {
      console.error("search error", err);
    }
  }

  function renderResults(list) {
    results.innerHTML = "";

    if (list.length === 0) {
      results.style.display = "none";
      return;
    }

    list.forEach(p => {
      const item = document.createElement("button");
      item.type = "button";
      item.className = "list-group-item list-group-item-action";
      item.style.fontSize = "10px";
      item.textContent = `${p.HN || ""} ${p.NAME || ""} ${p.LNAME || ""}`;

      item.onclick = () => fillForm(p);
      results.appendChild(item);
    });

    results.style.display = "block";
  }

  function fillForm(p) {
    document.querySelector('[name="patient_name"]').value =
      `${p.NAME || ""} ${p.LNAME || ""}`.trim();

    document.querySelector('[name="patient_id"]').value =
      p.HN || p.CID || "";

    results.style.display = "none";
  }

})();



</script>


