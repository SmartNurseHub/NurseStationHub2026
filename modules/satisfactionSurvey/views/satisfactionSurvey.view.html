<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body { background:#FEEFC6; font-family:'Prompt',sans-serif; }
    .card { border-radius:18px; border:none; }
    .card-header {
      background:linear-gradient(135deg,#006666);
      color:white;
      border-radius:18px 18px 0 0;
      padding:18px;
      position:relative;
    }
    table th, table td {
      text-align:center;
      vertical-align:middle;
      font-size:14px;
    }
    table td:first-child { text-align:left; font-weight:500; }
    .btn-submit { border-radius:40px; font-size:18px; padding:12px; }
    .service-box {
      background:#f8f9ff;
      border:1px solid #e0e7ff;
      border-radius:12px;
      padding:12px;
    }
    .card-header img { height:90px; }
  </style>
</head>

<body>

<div class="container mt-4 mb-5">
  <div class="card shadow">

    <!-- HEADER -->
    <div class="card-header d-flex align-items-center">
      <img src="https://drive.google.com/thumbnail?id=1XyNEhgREHCn8AnPztJNZbFHut1GuKI7z">
      <div class="text-center w-100 position-absolute start-50 translate-middle-x">
        <h4 class="mb-1">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h4>
        <h6 class="mb-1">‡∏°‡∏¥‡∏ï‡∏£‡πÑ‡∏°‡∏ï‡∏£‡∏µ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Ç‡∏≤‡∏ô‡πâ‡∏≠‡∏¢</h6>
        <small class="d-block mt-2">üåø ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏¥‡∏ä‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤ üåø</small>
      </div>
    </div>

    <!-- BODY -->
    <div class="card-body">
      <form id="feedbackForm">

        <!-- hidden UID from LINE -->
        <input type="hidden" id="uid">

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ -->
        <div class="row mb-3">
          <div class="col-md-3">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
            <input type="date" class="form-control" id="date" required>
          </div>
          <div class="col-md-5">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" class="form-control" id="fullName" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            <input type="tel" id="phone" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" pattern="[0-9]{9,10}" inputmode="numeric">

          </div>
        </div>

        <!-- ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ -->
        <div class="mb-4">
          <label class="form-label fw-semibold">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ</label>
          <div class="row service-box" id="servicesBox">
            <div class="col-md-4 col-6"><input type="checkbox" value="‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ"> ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ</div>
            <div class="col-md-4 col-6"><input type="checkbox" value="‡∏£‡∏±‡∏ö‡∏¢‡∏≤/‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£"> ‡∏£‡∏±‡∏ö‡∏¢‡∏≤/‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</div>
            <div class="col-md-4 col-6"><input type="checkbox" value="‡∏ó‡∏≥‡πÅ‡∏ú‡∏•/‡∏â‡∏µ‡∏î‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô"> ‡∏ó‡∏≥‡πÅ‡∏ú‡∏•/‡∏â‡∏µ‡∏î‡∏¢‡∏≤/‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</div>
            <div class="col-md-4 col-6"><input type="checkbox" value="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ"> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ</div>
            <div class="col-md-4 col-6"><input type="checkbox" value="‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤"> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</div>
            <div class="col-md-4 col-6">
              <input type="checkbox" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" id="serviceOtherChk"> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
              <input type="text" class="form-control mt-2" id="serviceOtherText" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏" style="display:none;">
          </div>
        </div>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° -->
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-primary">
              <tr>
                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th>
              </tr>
            </thead>
            <tbody id="questionTable"></tbody>
          </table>
        </div>

        <!-- comment -->
        <div class="mb-3">
          <label class="form-label">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
          <textarea class="form-control" id="comment" rows="3"></textarea>
        </div>

        <button type="button" class="btn btn-primary w-100 btn-submit" onclick="submitSurvey()">
          üì© ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
        </button>

      </form>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>



<script>
/* =====================
   QUESTIONS
===================== */
const questions = [
  "‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°",
  "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏™‡πà‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå/‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•",
  "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°",
  "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å",
  "‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡πà‡∏≤‡∏ô‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î"
];

function renderQuestions() {
  const tbody = document.getElementById("questionTable");
  questions.forEach((q, i) => {
    let tr = `<tr><td>${q}</td>`;
    for (let s = 1; s <= 5; s++) {
      tr += `<td><input type="radio" name="q${i+1}" value="${s}" required></td>`;
    }
    tr += "</tr>";
    tbody.insertAdjacentHTML("beforeend", tr);
  });
}

/* =====================
   SUBMIT (SUPPORT OTHER)
===================== */
async function submitSurvey() {
  const uid = document.getElementById("uid").value;
  const serviceDate = document.getElementById("date").value;

  if (!uid || !serviceDate) {
    Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö", "warning");
    return;
  }

  /* ===== SERVICES + OTHER ===== */
  let services = [...document.querySelectorAll("#servicesBox input:checked")]
    .map(el => el.value);

  const otherText = document.getElementById("serviceOtherText")?.value.trim();

  if (services.includes("‡∏≠‡∏∑‡πà‡∏ô‡πÜ")) {
    services = services.filter(v => v !== "‡∏≠‡∏∑‡πà‡∏ô‡πÜ");
    if (otherText) {
      services.push(`‡∏≠‡∏∑‡πà‡∏ô‡πÜ: ${otherText}`);
    } else {
      Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "warning");
      return;
    }
  }

  services = services.join(", ");

  const data = {
    uid,
    serviceDate,
    fullName: document.getElementById("fullName").value,
    phone: document.getElementById("phone").value,
    services,
    q1: document.querySelector('input[name="q1"]:checked')?.value || "",
    q2: document.querySelector('input[name="q2"]:checked')?.value || "",
    q3: document.querySelector('input[name="q3"]:checked')?.value || "",
    q4: document.querySelector('input[name="q4"]:checked')?.value || "",
    q5: document.querySelector('input[name="q5"]:checked')?.value || "",
    q6: document.querySelector('input[name="q6"]:checked')?.value || "",
    q7: document.querySelector('input[name="q7"]:checked')?.value || "",
    q8: document.querySelector('input[name="q8"]:checked')?.value || "",
    q9: document.querySelector('input[name="q9"]:checked')?.value || "",
    q10: document.querySelector('input[name="q10"]:checked')?.value || "",
    comment: document.getElementById("comment").value
  };

  Swal.fire({ title:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...", allowOutsideClick:false, didOpen:()=>Swal.showLoading() });

  try {
    const res = await fetch("/satisfaction-survey/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();
    Swal.close();

    if (result.status === "success") {
      Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô", "success")
        .then(() => window.liff && liff.isInClient() && liff.closeWindow());
    } else if (result.status === "duplicate") {
      Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏ó‡πà‡∏≤‡∏ô‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß", "warning");
    } else {
      Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ", "error");
    }

  } catch (err) {
    console.error(err);
    Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", "error");
  }
}

/* =====================
   INIT LIFF
===================== */
document.addEventListener("DOMContentLoaded", async () => {
  renderQuestions();

  // toggle ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
  const otherChk = document.getElementById("serviceOtherChk");
  if (otherChk) {
    otherChk.addEventListener("change", () => {
      document.getElementById("serviceOtherText").style.display =
        otherChk.checked ? "block" : "none";
      if (!otherChk.checked) {
        document.getElementById("serviceOtherText").value = "";
      }
    });
  }

  await liff.init({ liffId:"2007902507-7OKhdnNW" });
  if (!liff.isLoggedIn()) return liff.login();
  const profile = await liff.getProfile();
  document.getElementById("uid").value = profile.userId;
});
</script>


</body>
</html>
