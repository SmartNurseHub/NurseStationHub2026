<!-- =========================================================
     DASHBOARD VIEW
     ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô app.js ‚Üí navTo('dashboard')
========================================================= -->

<div class="container-fluid p-3">

  <!-- ===================== PAGE TITLE ===================== -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">üìä Dashboard</h4>
    <small class="text-muted">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</small>
  </div>

  <!-- ===================== SUMMARY CARDS ===================== -->
  <div class="row g-3 mb-4">

    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6>
          <h3 id="cardPatients" class="fw-bold text-primary">-</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</h6>
          <h3 id="cardNursing" class="fw-bold text-success">-</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h6>
          <h3 id="cardAppointments" class="fw-bold text-warning">-</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h6>
          <h3 class="fw-bold text-danger">1</h3>
        </div>
      </div>
    </div>

  </div>

  <!-- ===================== CHART SECTION ===================== -->
  <div class="row g-3">

    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold mb-3">üìà ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h6>
          <canvas id="patientsChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold mb-3">ü©∫ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</h6>
          <canvas id="nursingChart" height="120"></canvas>
        </div>
      </div>
    </div>

  </div>

</div>

<!-- ===================== DASHBOARD SCRIPT ===================== -->
<script>
(async function loadDashboard() {
  try {
    // ---------------- FETCH DATA ----------------
    const [patientsRes, nursingRes] = await Promise.all([
      fetch("/api/sheet/patients"),
      fetch("/api/sheet/nursing-records")
    ]);

    const patientsJson = await patientsRes.json();
    const nursingJson  = await nursingRes.json();

    const patients = patientsJson.data || [];
    const nursing  = nursingJson.data || [];

    // ---------------- UPDATE CARDS ----------------
    document.getElementById("cardPatients").textContent = patients.length;
    document.getElementById("cardNursing").textContent  = nursing.length;
    document.getElementById("cardAppointments").textContent = "-";

    // ---------------- PREPARE CHART DATA ----------------
    const months = ["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];

    // mock aggregation (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
    const patientCounts = months.map(() => Math.floor(Math.random() * 20) + 5);
    const nursingCounts = months.map(() => Math.floor(Math.random() * 30) + 10);

    // ---------------- PATIENTS CHART ----------------
    new Chart(document.getElementById("patientsChart"), {
      type: "line",
      data: {
        labels: months,
        datasets: [{
          label: "‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£",
          data: patientCounts,
          tension: 0.4,
          fill: true
        }]
      }
    });

    // ---------------- NURSING CHART ----------------
    new Chart(document.getElementById("nursingChart"), {
      type: "bar",
      data: {
        labels: months,
        datasets: [{
          label: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•",
          data: nursingCounts
        }]
      }
    });

  } catch (err) {
    console.error("Dashboard load error:", err);
  }
})();
</script>
